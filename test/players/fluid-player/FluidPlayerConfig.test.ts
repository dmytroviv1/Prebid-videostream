import { GenericConfiguration } from '../../../src/GenericConfiguration';
import logger from '../../../src/Logger';
import { fluidPlayerConfig } from '../../../src/players/fluid-player/FluidPlayerConfig';
import { Bid } from '../../../src/types/bid';
jest.mock('../../../src/Logger');

describe('Test cases for players/fluid-player/FluidPlayerConfig.js file', () => {
    const bid: Bid = {
        id: 'C4722BF1-599B-4CFC-A018-6CF7814DTEST',
        impid: '2fcbd3083f4088',
        price: 1.26,
        adm:
            '<VAST version="3.0"> <Ad id="1"> <Wrapper> <AdSystem>PubMatic</AdSystem> <VASTAdTagURI><![CDATA[https://staging.pubmatic.com:8443/video/vpaid/outstream.xml]]></VASTAdTagURI> <Error><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&er=[ERRORCODE]]]></Error> <Error><![CDATA[https://image8.pubmatic.com/AdServer/ImgSync?&fp=1&mpc=10&p=158011&gdpr=0&gdpr_consent=1&pmc=-1&pu=https%3A%2F%2Fimage4.pubmatic.com%2FAdServer%2FSPug%3Fpmc%3D-1%26partnerID%3D158011%26partnerUID%3D%28null%29]]></Error> <Impression><![CDATA[https://aktrack.pubmatic.com/AdServer/AdDisplayTrackerServlet?operId=1&pubId=158011&siteId=551324&adId=1954502&adType=13&adServerId=165&kefact={PSPM}&kaxefact={PSPM}&kadNetFrequecy=0&kadwidth=0&kadheight=0&kadsizeid=0&kltstamp=1560335696&indirectAdId=1720711&adServerOptimizerId=1&ranreq=NORANDOMNUMBERSPECIFIED&kpbmtpfact={PSPM}&tldId=0&passback=25&ekefact={PSPM}&ekaxefact={PSPM}&ekpbmtpfact={PSPM}&svr=ADS55003U&crID=0&campaignId=0&isRTB=0&kuip=115.114.134.174&imprId=74973DA7-A6B8-448F-9A3F-14A465B6CED4&oid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&cntryId=107&sec=1]]></Impression> <Impression><![CDATA[https://image8.pubmatic.com/AdServer/ImgSync?&fp=1&mpc=10&p=158011&gdpr=0&gdpr_consent=1&pmc=-1&pu=https%3A%2F%2Fimage4.pubmatic.com%2FAdServer%2FSPug%3Fpmc%3D-1%26partnerID%3D158011%26partnerUID%3D%28null%29]]></Impression> <Creatives> <Creative> <Linear> <TrackingEvents> <Tracking event="creativeView"><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=1]]></Tracking> <Tracking event="start"><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=2]]></Tracking> <Tracking event="midpoint"><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=3]]></Tracking> <Tracking event="firstQuartile"><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=4]]></Tracking> <Tracking event="thirdQuartile"><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=5]]></Tracking> <Tracking event="complete"><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=6]]></Tracking> </TrackingEvents> <VideoClicks> <ClickTracking><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=99]]></ClickTracking> </VideoClicks> </Linear> </Creative> </Creatives> <Extensions> <Extension> <Meta><![CDATA[name=pm-pixel;ver=1.0]]></Meta> <Pixel purpose="1" loc="0"> <Code type="0"><![CDATA[<script>(function (){try{var window = window ? window.parent : this.parent; /*Copyright (c) 2011-2016 Moat Inc. All Rights Reserved.*/ function initMoatTracking(b,c,g,p){var l=document.createElement("script"),f={events:[],addEvent:function(a){d.sendEvent?(f.events&&(d.sendEvent(f.events),f.events=!1),d.sendEvent(a)):f.events.push(a)}},a=function(a){return function(){var d=-1,h;b&&b.getAdVolume&&(h=b.getAdVolume());"number"==typeof h&&!isNaN(h)&&0<=h&&(d=h);f.addEvent({type:a,adVolume:d});if(-1!==q.indexOf(a)&&b&&b.unsubscribe&&!n){n=!0;for(var c in e)if(e.hasOwnProperty&&e.hasOwnProperty(c))try{b.unsubscribe(e[c],c)}catch(g){}}}}, d={adData:{ids:g,vpaid:b,build:"cc07a80-clean"},dispatchEvent:f.addEvent};g="_moatApi"+Math.floor(1E8*Math.random());var e={AdStarted:a("AdStarted"),AdStopped:a("AdStopped"),AdSkipped:a("AdSkipped"),AdLoaded:a("AdLoaded"),AdLinearChange:a("AdLinearChange"),AdSizeChange:a("AdSizeChange"),AdExpandedChange:a("AdExpandedChange"),AdSkippableStateChange:a("AdSkippableStateChange"),AdDurationChange:a("AdDurationChange"),AdRemainingTimeChange:a("AdRemainingTimeChange"),AdVolumeChange:a("AdVolumeChange"), AdImpression:a("AdImpression"),AdClickThru:a("AdClickThru"),AdInteraction:a("AdInteraction"),AdVideoStart:a("AdVideoStart"),AdVideoFirstQuartile:a("AdVideoFirstQuartile"),AdVideoMidpoint:a("AdVideoMidpoint"),AdVideoThirdQuartile:a("AdVideoThirdQuartile"),AdVideoComplete:a("AdVideoComplete"),AdUserAcceptInvitation:a("AdUserAcceptInvitation"),AdUserMinimize:a("AdUserMinimize"),AdUserClose:a("AdUserClose"),AdPaused:a("AdPaused"),AdPlaying:a("AdPlaying"),AdError:a("AdError")},n=!1,q=["AdStopped","AdSkipped", "AdVideoComplete"];(function(){if(b&&b.subscribe)for(var a in e)e.hasOwnProperty&&e.hasOwnProperty(a)&&b.subscribe(e[a],a)})();var k,m;try{k=c.ownerDocument,m=k.defaultView||k.parentWindow}catch(r){k=document,m=window}m[g]=d;l.type="text/javascript";c&&c.insertBefore(l,c.childNodes[0]||null);l.src="https://z.moatads.com/"+p+"/moatvideo.js#"+g;return d}; let pmVPAIDRef = window.getVPAIDAd(); let playerRef = window.AdParamConfigReader.vpaid && window.AdParamConfigReader.vpaid._slot; let ids = {"zMoatTagType":"video", "zMoatImp":"74973DA7-A6B8-448F-9A3F-14A465B6CED4", "level1":"158011", "level2":"551324", "level3":"1954502", "zMoatPP":"1.2", "slicer1":"", "level4":"1", "slicer2":"", "zMoatCntry":"107", "zMoatAdv":"1", "zMoatCamp":"0", "slicer3":"0", "zMoatDSP":"0", "zMoatBid":"", "zMoatUCR":"0"}; let partnerCode="pubmaticvpaidjsint469815710312"; var MoatApiReference = initMoatTracking(pmVPAIDRef, playerRef, ids, partnerCode); console.log("Pixel: " + MoatApiReference);} catch(ex) {console.error("Error in pixel execution: " + ex)} })();</script>]]></Code> </Pixel> </Extension> <Extension> <Meta><![CDATA[name=pm-forcepixel;ver=1.0]]></Meta> <Pixel loc="0"> <Code type="1"><![CDATA[https://ads.pubmatic.com/AdServer/js/showad.js#PIX&ptask=DSP&SPug=1&fp=1&mpc=10&u=47256CAB-25DF-4C1F-9B45-A2E16EBC6D5A&p=158011&s=551324&d=4&cp=0&sc=1&rs=0&os=0&gdpr=0&gdpr_consent=1]]></Code> </Pixel> </Extension> </Extensions> </Wrapper> </Ad> </VAST>',
        adomain: ['news.americanexpress.com'],
        cid: '16939',
        crid: '12345',
        ext: {
            dspid: 6,
            advid: 5863
        }
    };
    const elementId = 'test';
    const genericConfiguration: GenericConfiguration = {
        width: 40,
        height: 80,
        vastTimeout: 4000,
        maxAllowedVastTagRedirects: 4,
        allowVpaid: true,
        autoPlay: false,
        preload: false,
        mute: true,
        adText: 'Hi Valid Object'
    };
    const obj = fluidPlayerConfig(bid, elementId, genericConfiguration);

    beforeEach(() => {
        document.body.innerHTML = '<div id="' + elementId + '" style="display: block"></div>';
    });

    test('it should assign provided genericConfiguration values', () => {
        expect(obj.vastOptions.adText).toEqual(genericConfiguration.adText);
        expect(obj.vastOptions.vastTimeout).toEqual(genericConfiguration.vastTimeout);
        expect(obj.vastOptions.maxAllowedVastTagRedirects).toEqual(
            genericConfiguration.maxAllowedVastTagRedirects
        );
        expect(obj.vastOptions.allowVPAID).toEqual(genericConfiguration.allowVpaid);
        expect(obj.layoutControls.preload).toEqual(genericConfiguration.preload);
        expect(obj.layoutControls.mute).toEqual(genericConfiguration.mute);
    });

    test('it should assign DataURI, for vast XML', () => {
        let bid = {
            ad:
                '<VAST version="3.0"> <Ad id="1"> <Wrapper> <AdSystem>PubMatic</AdSystem> <VASTAdTagURI><![CDATA[https://staging.pubmatic.com:8443/video/vpaid/outstream.xml]]></VASTAdTagURI> <Error><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&er=[ERRORCODE]]]></Error> <Error><![CDATA[https://image8.pubmatic.com/AdServer/ImgSync?&fp=1&mpc=10&p=158011&gdpr=0&gdpr_consent=1&pmc=-1&pu=https%3A%2F%2Fimage4.pubmatic.com%2FAdServer%2FSPug%3Fpmc%3D-1%26partnerID%3D158011%26partnerUID%3D%28null%29]]></Error> <Impression><![CDATA[https://aktrack.pubmatic.com/AdServer/AdDisplayTrackerServlet?operId=1&pubId=158011&siteId=551324&adId=1954502&adType=13&adServerId=165&kefact={PSPM}&kaxefact={PSPM}&kadNetFrequecy=0&kadwidth=0&kadheight=0&kadsizeid=0&kltstamp=1560335696&indirectAdId=1720711&adServerOptimizerId=1&ranreq=NORANDOMNUMBERSPECIFIED&kpbmtpfact={PSPM}&tldId=0&passback=25&ekefact={PSPM}&ekaxefact={PSPM}&ekpbmtpfact={PSPM}&svr=ADS55003U&crID=0&campaignId=0&isRTB=0&kuip=115.114.134.174&imprId=74973DA7-A6B8-448F-9A3F-14A465B6CED4&oid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&cntryId=107&sec=1]]></Impression> <Impression><![CDATA[https://image8.pubmatic.com/AdServer/ImgSync?&fp=1&mpc=10&p=158011&gdpr=0&gdpr_consent=1&pmc=-1&pu=https%3A%2F%2Fimage4.pubmatic.com%2FAdServer%2FSPug%3Fpmc%3D-1%26partnerID%3D158011%26partnerUID%3D%28null%29]]></Impression> <Creatives> <Creative> <Linear> <TrackingEvents> <Tracking event="creativeView"><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=1]]></Tracking> <Tracking event="start"><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=2]]></Tracking> <Tracking event="midpoint"><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=3]]></Tracking> <Tracking event="firstQuartile"><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=4]]></Tracking> <Tracking event="thirdQuartile"><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=5]]></Tracking> <Tracking event="complete"><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=6]]></Tracking> </TrackingEvents> <VideoClicks> <ClickTracking><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=99]]></ClickTracking> </VideoClicks> </Linear> </Creative> </Creatives> <Extensions> <Extension> <Meta><![CDATA[name=pm-pixel;ver=1.0]]></Meta> <Pixel purpose="1" loc="0"> <Code type="0"><![CDATA[<script>(function (){try{var window = window ? window.parent : this.parent; /*Copyright (c) 2011-2016 Moat Inc. All Rights Reserved.*/ function initMoatTracking(b,c,g,p){var l=document.createElement("script"),f={events:[],addEvent:function(a){d.sendEvent?(f.events&&(d.sendEvent(f.events),f.events=!1),d.sendEvent(a)):f.events.push(a)}},a=function(a){return function(){var d=-1,h;b&&b.getAdVolume&&(h=b.getAdVolume());"number"==typeof h&&!isNaN(h)&&0<=h&&(d=h);f.addEvent({type:a,adVolume:d});if(-1!==q.indexOf(a)&&b&&b.unsubscribe&&!n){n=!0;for(var c in e)if(e.hasOwnProperty&&e.hasOwnProperty(c))try{b.unsubscribe(e[c],c)}catch(g){}}}}, d={adData:{ids:g,vpaid:b,build:"cc07a80-clean"},dispatchEvent:f.addEvent};g="_moatApi"+Math.floor(1E8*Math.random());var e={AdStarted:a("AdStarted"),AdStopped:a("AdStopped"),AdSkipped:a("AdSkipped"),AdLoaded:a("AdLoaded"),AdLinearChange:a("AdLinearChange"),AdSizeChange:a("AdSizeChange"),AdExpandedChange:a("AdExpandedChange"),AdSkippableStateChange:a("AdSkippableStateChange"),AdDurationChange:a("AdDurationChange"),AdRemainingTimeChange:a("AdRemainingTimeChange"),AdVolumeChange:a("AdVolumeChange"), AdImpression:a("AdImpression"),AdClickThru:a("AdClickThru"),AdInteraction:a("AdInteraction"),AdVideoStart:a("AdVideoStart"),AdVideoFirstQuartile:a("AdVideoFirstQuartile"),AdVideoMidpoint:a("AdVideoMidpoint"),AdVideoThirdQuartile:a("AdVideoThirdQuartile"),AdVideoComplete:a("AdVideoComplete"),AdUserAcceptInvitation:a("AdUserAcceptInvitation"),AdUserMinimize:a("AdUserMinimize"),AdUserClose:a("AdUserClose"),AdPaused:a("AdPaused"),AdPlaying:a("AdPlaying"),AdError:a("AdError")},n=!1,q=["AdStopped","AdSkipped", "AdVideoComplete"];(function(){if(b&&b.subscribe)for(var a in e)e.hasOwnProperty&&e.hasOwnProperty(a)&&b.subscribe(e[a],a)})();var k,m;try{k=c.ownerDocument,m=k.defaultView||k.parentWindow}catch(r){k=document,m=window}m[g]=d;l.type="text/javascript";c&&c.insertBefore(l,c.childNodes[0]||null);l.src="https://z.moatads.com/"+p+"/moatvideo.js#"+g;return d}; let pmVPAIDRef = window.getVPAIDAd(); let playerRef = window.AdParamConfigReader.vpaid && window.AdParamConfigReader.vpaid._slot; let ids = {"zMoatTagType":"video", "zMoatImp":"74973DA7-A6B8-448F-9A3F-14A465B6CED4", "level1":"158011", "level2":"551324", "level3":"1954502", "zMoatPP":"1.2", "slicer1":"", "level4":"1", "slicer2":"", "zMoatCntry":"107", "zMoatAdv":"1", "zMoatCamp":"0", "slicer3":"0", "zMoatDSP":"0", "zMoatBid":"", "zMoatUCR":"0"}; let partnerCode="pubmaticvpaidjsint469815710312"; var MoatApiReference = initMoatTracking(pmVPAIDRef, playerRef, ids, partnerCode); console.log("Pixel: " + MoatApiReference);} catch(ex) {console.error("Error in pixel execution: " + ex)} })();</script>]]></Code> </Pixel> </Extension> <Extension> <Meta><![CDATA[name=pm-forcepixel;ver=1.0]]></Meta> <Pixel loc="0"> <Code type="1"><![CDATA[https://ads.pubmatic.com/AdServer/js/showad.js#PIX&ptask=DSP&SPug=1&fp=1&mpc=10&u=47256CAB-25DF-4C1F-9B45-A2E16EBC6D5A&p=158011&s=551324&d=4&cp=0&sc=1&rs=0&os=0&gdpr=0&gdpr_consent=1]]></Code> </Pixel> </Extension> </Extensions> </Wrapper> </Ad> </VAST>'
        };
        let base64Encoding =
            'PFZBU1QgdmVyc2lvbj0iMy4wIj4gPEFkIGlkPSIxIj4gPFdyYXBwZXI+IDxBZFN5c3RlbT5QdWJNYXRpYzwvQWRTeXN0ZW0+IDxWQVNUQWRUYWdVUkk+PCFbQ0RBVEFbaHR0cHM6Ly9zdGFnaW5nLnB1Ym1hdGljLmNvbTo4NDQzL3ZpZGVvL3ZwYWlkL291dHN0cmVhbS54bWxdXT48L1ZBU1RBZFRhZ1VSST4gPEVycm9yPjwhW0NEQVRBW2h0dHBzOi8vYWt0cmFjay5wdWJtYXRpYy5jb20vdHJhY2s/b3BlcklkPTcmcD0xNTgwMTEmcz01NTEzMjQmYT0xOTU0NTAyJndhPTE2NSZ0cz0xNTYwMzM1Njk2JmNySWQ9MCZpbXBpZD03NDk3M0RBNy1BNkI4LTQ0OEYtOUEzRi0xNEE0NjVCNkNFRDQmZWNwbT0xLjIwMDAwMCZlcj1bRVJST1JDT0RFXV1dPjwvRXJyb3I+IDxFcnJvcj48IVtDREFUQVtodHRwczovL2ltYWdlOC5wdWJtYXRpYy5jb20vQWRTZXJ2ZXIvSW1nU3luYz8mZnA9MSZtcGM9MTAmcD0xNTgwMTEmZ2Rwcj0wJmdkcHJfY29uc2VudD0xJnBtYz0tMSZwdT1odHRwcyUzQSUyRiUyRmltYWdlNC5wdWJtYXRpYy5jb20lMkZBZFNlcnZlciUyRlNQdWclM0ZwbWMlM0QtMSUyNnBhcnRuZXJJRCUzRDE1ODAxMSUyNnBhcnRuZXJVSUQlM0QlMjhudWxsJTI5XV0+PC9FcnJvcj4gPEltcHJlc3Npb24+PCFbQ0RBVEFbaHR0cHM6Ly9ha3RyYWNrLnB1Ym1hdGljLmNvbS9BZFNlcnZlci9BZERpc3BsYXlUcmFja2VyU2VydmxldD9vcGVySWQ9MSZwdWJJZD0xNTgwMTEmc2l0ZUlkPTU1MTMyNCZhZElkPTE5NTQ1MDImYWRUeXBlPTEzJmFkU2VydmVySWQ9MTY1JmtlZmFjdD17UFNQTX0ma2F4ZWZhY3Q9e1BTUE19JmthZE5ldEZyZXF1ZWN5PTAma2Fkd2lkdGg9MCZrYWRoZWlnaHQ9MCZrYWRzaXplaWQ9MCZrbHRzdGFtcD0xNTYwMzM1Njk2JmluZGlyZWN0QWRJZD0xNzIwNzExJmFkU2VydmVyT3B0aW1pemVySWQ9MSZyYW5yZXE9Tk9SQU5ET01OVU1CRVJTUEVDSUZJRUQma3BibXRwZmFjdD17UFNQTX0mdGxkSWQ9MCZwYXNzYmFjaz0yNSZla2VmYWN0PXtQU1BNfSZla2F4ZWZhY3Q9e1BTUE19JmVrcGJtdHBmYWN0PXtQU1BNfSZzdnI9QURTNTUwMDNVJmNySUQ9MCZjYW1wYWlnbklkPTAmaXNSVEI9MCZrdWlwPTExNS4xMTQuMTM0LjE3NCZpbXBySWQ9NzQ5NzNEQTctQTZCOC00NDhGLTlBM0YtMTRBNDY1QjZDRUQ0Jm9pZD03NDk3M0RBNy1BNkI4LTQ0OEYtOUEzRi0xNEE0NjVCNkNFRDQmY250cnlJZD0xMDcmc2VjPTFdXT48L0ltcHJlc3Npb24+IDxJbXByZXNzaW9uPjwhW0NEQVRBW2h0dHBzOi8vaW1hZ2U4LnB1Ym1hdGljLmNvbS9BZFNlcnZlci9JbWdTeW5jPyZmcD0xJm1wYz0xMCZwPTE1ODAxMSZnZHByPTAmZ2Rwcl9jb25zZW50PTEmcG1jPS0xJnB1PWh0dHBzJTNBJTJGJTJGaW1hZ2U0LnB1Ym1hdGljLmNvbSUyRkFkU2VydmVyJTJGU1B1ZyUzRnBtYyUzRC0xJTI2cGFydG5lcklEJTNEMTU4MDExJTI2cGFydG5lclVJRCUzRCUyOG51bGwlMjldXT48L0ltcHJlc3Npb24+IDxDcmVhdGl2ZXM+IDxDcmVhdGl2ZT4gPExpbmVhcj4gPFRyYWNraW5nRXZlbnRzPiA8VHJhY2tpbmcgZXZlbnQ9ImNyZWF0aXZlVmlldyI+PCFbQ0RBVEFbaHR0cHM6Ly9ha3RyYWNrLnB1Ym1hdGljLmNvbS90cmFjaz9vcGVySWQ9NyZwPTE1ODAxMSZzPTU1MTMyNCZhPTE5NTQ1MDImd2E9MTY1JnRzPTE1NjAzMzU2OTYmY3JJZD0wJmltcGlkPTc0OTczREE3LUE2QjgtNDQ4Ri05QTNGLTE0QTQ2NUI2Q0VENCZlY3BtPTEuMjAwMDAwJmU9MV1dPjwvVHJhY2tpbmc+IDxUcmFja2luZyBldmVudD0ic3RhcnQiPjwhW0NEQVRBW2h0dHBzOi8vYWt0cmFjay5wdWJtYXRpYy5jb20vdHJhY2s/b3BlcklkPTcmcD0xNTgwMTEmcz01NTEzMjQmYT0xOTU0NTAyJndhPTE2NSZ0cz0xNTYwMzM1Njk2JmNySWQ9MCZpbXBpZD03NDk3M0RBNy1BNkI4LTQ0OEYtOUEzRi0xNEE0NjVCNkNFRDQmZWNwbT0xLjIwMDAwMCZlPTJdXT48L1RyYWNraW5nPiA8VHJhY2tpbmcgZXZlbnQ9Im1pZHBvaW50Ij48IVtDREFUQVtodHRwczovL2FrdHJhY2sucHVibWF0aWMuY29tL3RyYWNrP29wZXJJZD03JnA9MTU4MDExJnM9NTUxMzI0JmE9MTk1NDUwMiZ3YT0xNjUmdHM9MTU2MDMzNTY5NiZjcklkPTAmaW1waWQ9NzQ5NzNEQTctQTZCOC00NDhGLTlBM0YtMTRBNDY1QjZDRUQ0JmVjcG09MS4yMDAwMDAmZT0zXV0+PC9UcmFja2luZz4gPFRyYWNraW5nIGV2ZW50PSJmaXJzdFF1YXJ0aWxlIj48IVtDREFUQVtodHRwczovL2FrdHJhY2sucHVibWF0aWMuY29tL3RyYWNrP29wZXJJZD03JnA9MTU4MDExJnM9NTUxMzI0JmE9MTk1NDUwMiZ3YT0xNjUmdHM9MTU2MDMzNTY5NiZjcklkPTAmaW1waWQ9NzQ5NzNEQTctQTZCOC00NDhGLTlBM0YtMTRBNDY1QjZDRUQ0JmVjcG09MS4yMDAwMDAmZT00XV0+PC9UcmFja2luZz4gPFRyYWNraW5nIGV2ZW50PSJ0aGlyZFF1YXJ0aWxlIj48IVtDREFUQVtodHRwczovL2FrdHJhY2sucHVibWF0aWMuY29tL3RyYWNrP29wZXJJZD03JnA9MTU4MDExJnM9NTUxMzI0JmE9MTk1NDUwMiZ3YT0xNjUmdHM9MTU2MDMzNTY5NiZjcklkPTAmaW1waWQ9NzQ5NzNEQTctQTZCOC00NDhGLTlBM0YtMTRBNDY1QjZDRUQ0JmVjcG09MS4yMDAwMDAmZT01XV0+PC9UcmFja2luZz4gPFRyYWNraW5nIGV2ZW50PSJjb21wbGV0ZSI+PCFbQ0RBVEFbaHR0cHM6Ly9ha3RyYWNrLnB1Ym1hdGljLmNvbS90cmFjaz9vcGVySWQ9NyZwPTE1ODAxMSZzPTU1MTMyNCZhPTE5NTQ1MDImd2E9MTY1JnRzPTE1NjAzMzU2OTYmY3JJZD0wJmltcGlkPTc0OTczREE3LUE2QjgtNDQ4Ri05QTNGLTE0QTQ2NUI2Q0VENCZlY3BtPTEuMjAwMDAwJmU9Nl1dPjwvVHJhY2tpbmc+IDwvVHJhY2tpbmdFdmVudHM+IDxWaWRlb0NsaWNrcz4gPENsaWNrVHJhY2tpbmc+PCFbQ0RBVEFbaHR0cHM6Ly9ha3RyYWNrLnB1Ym1hdGljLmNvbS90cmFjaz9vcGVySWQ9NyZwPTE1ODAxMSZzPTU1MTMyNCZhPTE5NTQ1MDImd2E9MTY1JnRzPTE1NjAzMzU2OTYmY3JJZD0wJmltcGlkPTc0OTczREE3LUE2QjgtNDQ4Ri05QTNGLTE0QTQ2NUI2Q0VENCZlY3BtPTEuMjAwMDAwJmU9OTldXT48L0NsaWNrVHJhY2tpbmc+IDwvVmlkZW9DbGlja3M+IDwvTGluZWFyPiA8L0NyZWF0aXZlPiA8L0NyZWF0aXZlcz4gPEV4dGVuc2lvbnM+IDxFeHRlbnNpb24+IDxNZXRhPjwhW0NEQVRBW25hbWU9cG0tcGl4ZWw7dmVyPTEuMF1dPjwvTWV0YT4gPFBpeGVsIHB1cnBvc2U9IjEiIGxvYz0iMCI+IDxDb2RlIHR5cGU9IjAiPjwhW0NEQVRBWzxzY3JpcHQ+KGZ1bmN0aW9uICgpe3RyeXt2YXIgd2luZG93ID0gd2luZG93ID8gd2luZG93LnBhcmVudCA6IHRoaXMucGFyZW50OyAvKkNvcHlyaWdodCAoYykgMjAxMS0yMDE2IE1vYXQgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLiovIGZ1bmN0aW9uIGluaXRNb2F0VHJhY2tpbmcoYixjLGcscCl7dmFyIGw9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0IiksZj17ZXZlbnRzOltdLGFkZEV2ZW50OmZ1bmN0aW9uKGEpe2Quc2VuZEV2ZW50PyhmLmV2ZW50cyYmKGQuc2VuZEV2ZW50KGYuZXZlbnRzKSxmLmV2ZW50cz0hMSksZC5zZW5kRXZlbnQoYSkpOmYuZXZlbnRzLnB1c2goYSl9fSxhPWZ1bmN0aW9uKGEpe3JldHVybiBmdW5jdGlvbigpe3ZhciBkPS0xLGg7YiYmYi5nZXRBZFZvbHVtZSYmKGg9Yi5nZXRBZFZvbHVtZSgpKTsibnVtYmVyIj09dHlwZW9mIGgmJiFpc05hTihoKSYmMDw9aCYmKGQ9aCk7Zi5hZGRFdmVudCh7dHlwZTphLGFkVm9sdW1lOmR9KTtpZigtMSE9PXEuaW5kZXhPZihhKSYmYiYmYi51bnN1YnNjcmliZSYmIW4pe249ITA7Zm9yKHZhciBjIGluIGUpaWYoZS5oYXNPd25Qcm9wZXJ0eSYmZS5oYXNPd25Qcm9wZXJ0eShjKSl0cnl7Yi51bnN1YnNjcmliZShlW2NdLGMpfWNhdGNoKGcpe319fX0sIGQ9e2FkRGF0YTp7aWRzOmcsdnBhaWQ6YixidWlsZDoiY2MwN2E4MC1jbGVhbiJ9LGRpc3BhdGNoRXZlbnQ6Zi5hZGRFdmVudH07Zz0iX21vYXRBcGkiK01hdGguZmxvb3IoMUU4Kk1hdGgucmFuZG9tKCkpO3ZhciBlPXtBZFN0YXJ0ZWQ6YSgiQWRTdGFydGVkIiksQWRTdG9wcGVkOmEoIkFkU3RvcHBlZCIpLEFkU2tpcHBlZDphKCJBZFNraXBwZWQiKSxBZExvYWRlZDphKCJBZExvYWRlZCIpLEFkTGluZWFyQ2hhbmdlOmEoIkFkTGluZWFyQ2hhbmdlIiksQWRTaXplQ2hhbmdlOmEoIkFkU2l6ZUNoYW5nZSIpLEFkRXhwYW5kZWRDaGFuZ2U6YSgiQWRFeHBhbmRlZENoYW5nZSIpLEFkU2tpcHBhYmxlU3RhdGVDaGFuZ2U6YSgiQWRTa2lwcGFibGVTdGF0ZUNoYW5nZSIpLEFkRHVyYXRpb25DaGFuZ2U6YSgiQWREdXJhdGlvbkNoYW5nZSIpLEFkUmVtYWluaW5nVGltZUNoYW5nZTphKCJBZFJlbWFpbmluZ1RpbWVDaGFuZ2UiKSxBZFZvbHVtZUNoYW5nZTphKCJBZFZvbHVtZUNoYW5nZSIpLCBBZEltcHJlc3Npb246YSgiQWRJbXByZXNzaW9uIiksQWRDbGlja1RocnU6YSgiQWRDbGlja1RocnUiKSxBZEludGVyYWN0aW9uOmEoIkFkSW50ZXJhY3Rpb24iKSxBZFZpZGVvU3RhcnQ6YSgiQWRWaWRlb1N0YXJ0IiksQWRWaWRlb0ZpcnN0UXVhcnRpbGU6YSgiQWRWaWRlb0ZpcnN0UXVhcnRpbGUiKSxBZFZpZGVvTWlkcG9pbnQ6YSgiQWRWaWRlb01pZHBvaW50IiksQWRWaWRlb1RoaXJkUXVhcnRpbGU6YSgiQWRWaWRlb1RoaXJkUXVhcnRpbGUiKSxBZFZpZGVvQ29tcGxldGU6YSgiQWRWaWRlb0NvbXBsZXRlIiksQWRVc2VyQWNjZXB0SW52aXRhdGlvbjphKCJBZFVzZXJBY2NlcHRJbnZpdGF0aW9uIiksQWRVc2VyTWluaW1pemU6YSgiQWRVc2VyTWluaW1pemUiKSxBZFVzZXJDbG9zZTphKCJBZFVzZXJDbG9zZSIpLEFkUGF1c2VkOmEoIkFkUGF1c2VkIiksQWRQbGF5aW5nOmEoIkFkUGxheWluZyIpLEFkRXJyb3I6YSgiQWRFcnJvciIpfSxuPSExLHE9WyJBZFN0b3BwZWQiLCJBZFNraXBwZWQiLCAiQWRWaWRlb0NvbXBsZXRlIl07KGZ1bmN0aW9uKCl7aWYoYiYmYi5zdWJzY3JpYmUpZm9yKHZhciBhIGluIGUpZS5oYXNPd25Qcm9wZXJ0eSYmZS5oYXNPd25Qcm9wZXJ0eShhKSYmYi5zdWJzY3JpYmUoZVthXSxhKX0pKCk7dmFyIGssbTt0cnl7az1jLm93bmVyRG9jdW1lbnQsbT1rLmRlZmF1bHRWaWV3fHxrLnBhcmVudFdpbmRvd31jYXRjaChyKXtrPWRvY3VtZW50LG09d2luZG93fW1bZ109ZDtsLnR5cGU9InRleHQvamF2YXNjcmlwdCI7YyYmYy5pbnNlcnRCZWZvcmUobCxjLmNoaWxkTm9kZXNbMF18fG51bGwpO2wuc3JjPSJodHRwczovL3oubW9hdGFkcy5jb20vIitwKyIvbW9hdHZpZGVvLmpzIyIrZztyZXR1cm4gZH07IGxldCBwbVZQQUlEUmVmID0gd2luZG93LmdldFZQQUlEQWQoKTsgbGV0IHBsYXllclJlZiA9IHdpbmRvdy5BZFBhcmFtQ29uZmlnUmVhZGVyLnZwYWlkICYmIHdpbmRvdy5BZFBhcmFtQ29uZmlnUmVhZGVyLnZwYWlkLl9zbG90OyBsZXQgaWRzID0geyJ6TW9hdFRhZ1R5cGUiOiJ2aWRlbyIsICJ6TW9hdEltcCI6Ijc0OTczREE3LUE2QjgtNDQ4Ri05QTNGLTE0QTQ2NUI2Q0VENCIsICJsZXZlbDEiOiIxNTgwMTEiLCAibGV2ZWwyIjoiNTUxMzI0IiwgImxldmVsMyI6IjE5NTQ1MDIiLCAiek1vYXRQUCI6IjEuMiIsICJzbGljZXIxIjoiIiwgImxldmVsNCI6IjEiLCAic2xpY2VyMiI6IiIsICJ6TW9hdENudHJ5IjoiMTA3IiwgInpNb2F0QWR2IjoiMSIsICJ6TW9hdENhbXAiOiIwIiwgInNsaWNlcjMiOiIwIiwgInpNb2F0RFNQIjoiMCIsICJ6TW9hdEJpZCI6IiIsICJ6TW9hdFVDUiI6IjAifTsgbGV0IHBhcnRuZXJDb2RlPSJwdWJtYXRpY3ZwYWlkanNpbnQ0Njk4MTU3MTAzMTIiOyB2YXIgTW9hdEFwaVJlZmVyZW5jZSA9IGluaXRNb2F0VHJhY2tpbmcocG1WUEFJRFJlZiwgcGxheWVyUmVmLCBpZHMsIHBhcnRuZXJDb2RlKTsgY29uc29sZS5sb2coIlBpeGVsOiAiICsgTW9hdEFwaVJlZmVyZW5jZSk7fSBjYXRjaChleCkge2NvbnNvbGUuZXJyb3IoIkVycm9yIGluIHBpeGVsIGV4ZWN1dGlvbjogIiArIGV4KX0gfSkoKTs8L3NjcmlwdD5dXT48L0NvZGU+IDwvUGl4ZWw+IDwvRXh0ZW5zaW9uPiA8RXh0ZW5zaW9uPiA8TWV0YT48IVtDREFUQVtuYW1lPXBtLWZvcmNlcGl4ZWw7dmVyPTEuMF1dPjwvTWV0YT4gPFBpeGVsIGxvYz0iMCI+IDxDb2RlIHR5cGU9IjEiPjwhW0NEQVRBW2h0dHBzOi8vYWRzLnB1Ym1hdGljLmNvbS9BZFNlcnZlci9qcy9zaG93YWQuanMjUElYJnB0YXNrPURTUCZTUHVnPTEmZnA9MSZtcGM9MTAmdT00NzI1NkNBQi0yNURGLTRDMUYtOUI0NS1BMkUxNkVCQzZENUEmcD0xNTgwMTEmcz01NTEzMjQmZD00JmNwPTAmc2M9MSZycz0wJm9zPTAmZ2Rwcj0wJmdkcHJfY29uc2VudD0xXV0+PC9Db2RlPiA8L1BpeGVsPiA8L0V4dGVuc2lvbj4gPC9FeHRlbnNpb25zPiA8L1dyYXBwZXI+IDwvQWQ+IDwvVkFTVD4=';
        let base64String = 'data:text/xml;charset=utf-8;base64,' + base64Encoding;
        let obj = fluidPlayerConfig(bid, elementId, genericConfiguration);
        expect(obj.vastOptions.adList[0].vastTag).toEqual(base64String);
    });

    test('it should assign VAST Tag', () => {
        let bid = {
            ad:
                'https://pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/124319096/external/single_ad_samples&ciu_szs=300x250&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&cust_params=deployment%3Ddevsite%26sample_ct%3Dlinear&correlator='
        };

        let obj = fluidPlayerConfig(bid, elementId, genericConfiguration);
        expect(obj.vastOptions.adList[0].vastTag).toEqual(bid.ad);
    });

    test('it should use bid.vastXml, if bid.ad is not present', () => {
        let bid = {
            vastXml:
                '<VAST version="3.0"> <Ad id="1"> <Wrapper> <AdSystem>PubMatic</AdSystem> <VASTAdTagURI><![CDATA[https://staging.pubmatic.com:8443/video/vpaid/outstream.xml]]></VASTAdTagURI> <Error><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&er=[ERRORCODE]]]></Error> <Error><![CDATA[https://image8.pubmatic.com/AdServer/ImgSync?&fp=1&mpc=10&p=158011&gdpr=0&gdpr_consent=1&pmc=-1&pu=https%3A%2F%2Fimage4.pubmatic.com%2FAdServer%2FSPug%3Fpmc%3D-1%26partnerID%3D158011%26partnerUID%3D%28null%29]]></Error> <Impression><![CDATA[https://aktrack.pubmatic.com/AdServer/AdDisplayTrackerServlet?operId=1&pubId=158011&siteId=551324&adId=1954502&adType=13&adServerId=165&kefact={PSPM}&kaxefact={PSPM}&kadNetFrequecy=0&kadwidth=0&kadheight=0&kadsizeid=0&kltstamp=1560335696&indirectAdId=1720711&adServerOptimizerId=1&ranreq=NORANDOMNUMBERSPECIFIED&kpbmtpfact={PSPM}&tldId=0&passback=25&ekefact={PSPM}&ekaxefact={PSPM}&ekpbmtpfact={PSPM}&svr=ADS55003U&crID=0&campaignId=0&isRTB=0&kuip=115.114.134.174&imprId=74973DA7-A6B8-448F-9A3F-14A465B6CED4&oid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&cntryId=107&sec=1]]></Impression> <Impression><![CDATA[https://image8.pubmatic.com/AdServer/ImgSync?&fp=1&mpc=10&p=158011&gdpr=0&gdpr_consent=1&pmc=-1&pu=https%3A%2F%2Fimage4.pubmatic.com%2FAdServer%2FSPug%3Fpmc%3D-1%26partnerID%3D158011%26partnerUID%3D%28null%29]]></Impression> <Creatives> <Creative> <Linear> <TrackingEvents> <Tracking event="creativeView"><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=1]]></Tracking> <Tracking event="start"><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=2]]></Tracking> <Tracking event="midpoint"><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=3]]></Tracking> <Tracking event="firstQuartile"><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=4]]></Tracking> <Tracking event="thirdQuartile"><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=5]]></Tracking> <Tracking event="complete"><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=6]]></Tracking> </TrackingEvents> <VideoClicks> <ClickTracking><![CDATA[https://aktrack.pubmatic.com/track?operId=7&p=158011&s=551324&a=1954502&wa=165&ts=1560335696&crId=0&impid=74973DA7-A6B8-448F-9A3F-14A465B6CED4&ecpm=1.200000&e=99]]></ClickTracking> </VideoClicks> </Linear> </Creative> </Creatives> <Extensions> <Extension> <Meta><![CDATA[name=pm-pixel;ver=1.0]]></Meta> <Pixel purpose="1" loc="0"> <Code type="0"><![CDATA[<script>(function (){try{var window = window ? window.parent : this.parent; /*Copyright (c) 2011-2016 Moat Inc. All Rights Reserved.*/ function initMoatTracking(b,c,g,p){var l=document.createElement("script"),f={events:[],addEvent:function(a){d.sendEvent?(f.events&&(d.sendEvent(f.events),f.events=!1),d.sendEvent(a)):f.events.push(a)}},a=function(a){return function(){var d=-1,h;b&&b.getAdVolume&&(h=b.getAdVolume());"number"==typeof h&&!isNaN(h)&&0<=h&&(d=h);f.addEvent({type:a,adVolume:d});if(-1!==q.indexOf(a)&&b&&b.unsubscribe&&!n){n=!0;for(var c in e)if(e.hasOwnProperty&&e.hasOwnProperty(c))try{b.unsubscribe(e[c],c)}catch(g){}}}}, d={adData:{ids:g,vpaid:b,build:"cc07a80-clean"},dispatchEvent:f.addEvent};g="_moatApi"+Math.floor(1E8*Math.random());var e={AdStarted:a("AdStarted"),AdStopped:a("AdStopped"),AdSkipped:a("AdSkipped"),AdLoaded:a("AdLoaded"),AdLinearChange:a("AdLinearChange"),AdSizeChange:a("AdSizeChange"),AdExpandedChange:a("AdExpandedChange"),AdSkippableStateChange:a("AdSkippableStateChange"),AdDurationChange:a("AdDurationChange"),AdRemainingTimeChange:a("AdRemainingTimeChange"),AdVolumeChange:a("AdVolumeChange"), AdImpression:a("AdImpression"),AdClickThru:a("AdClickThru"),AdInteraction:a("AdInteraction"),AdVideoStart:a("AdVideoStart"),AdVideoFirstQuartile:a("AdVideoFirstQuartile"),AdVideoMidpoint:a("AdVideoMidpoint"),AdVideoThirdQuartile:a("AdVideoThirdQuartile"),AdVideoComplete:a("AdVideoComplete"),AdUserAcceptInvitation:a("AdUserAcceptInvitation"),AdUserMinimize:a("AdUserMinimize"),AdUserClose:a("AdUserClose"),AdPaused:a("AdPaused"),AdPlaying:a("AdPlaying"),AdError:a("AdError")},n=!1,q=["AdStopped","AdSkipped", "AdVideoComplete"];(function(){if(b&&b.subscribe)for(var a in e)e.hasOwnProperty&&e.hasOwnProperty(a)&&b.subscribe(e[a],a)})();var k,m;try{k=c.ownerDocument,m=k.defaultView||k.parentWindow}catch(r){k=document,m=window}m[g]=d;l.type="text/javascript";c&&c.insertBefore(l,c.childNodes[0]||null);l.src="https://z.moatads.com/"+p+"/moatvideo.js#"+g;return d}; let pmVPAIDRef = window.getVPAIDAd(); let playerRef = window.AdParamConfigReader.vpaid && window.AdParamConfigReader.vpaid._slot; let ids = {"zMoatTagType":"video", "zMoatImp":"74973DA7-A6B8-448F-9A3F-14A465B6CED4", "level1":"158011", "level2":"551324", "level3":"1954502", "zMoatPP":"1.2", "slicer1":"", "level4":"1", "slicer2":"", "zMoatCntry":"107", "zMoatAdv":"1", "zMoatCamp":"0", "slicer3":"0", "zMoatDSP":"0", "zMoatBid":"", "zMoatUCR":"0"}; let partnerCode="pubmaticvpaidjsint469815710312"; var MoatApiReference = initMoatTracking(pmVPAIDRef, playerRef, ids, partnerCode); console.log("Pixel: " + MoatApiReference);} catch(ex) {console.error("Error in pixel execution: " + ex)} })();</script>]]></Code> </Pixel> </Extension> <Extension> <Meta><![CDATA[name=pm-forcepixel;ver=1.0]]></Meta> <Pixel loc="0"> <Code type="1"><![CDATA[https://ads.pubmatic.com/AdServer/js/showad.js#PIX&ptask=DSP&SPug=1&fp=1&mpc=10&u=47256CAB-25DF-4C1F-9B45-A2E16EBC6D5A&p=158011&s=551324&d=4&cp=0&sc=1&rs=0&os=0&gdpr=0&gdpr_consent=1]]></Code> </Pixel> </Extension> </Extensions> </Wrapper> </Ad> </VAST>'
        };
        let base64Encoding =
            'PFZBU1QgdmVyc2lvbj0iMy4wIj4gPEFkIGlkPSIxIj4gPFdyYXBwZXI+IDxBZFN5c3RlbT5QdWJNYXRpYzwvQWRTeXN0ZW0+IDxWQVNUQWRUYWdVUkk+PCFbQ0RBVEFbaHR0cHM6Ly9zdGFnaW5nLnB1Ym1hdGljLmNvbTo4NDQzL3ZpZGVvL3ZwYWlkL291dHN0cmVhbS54bWxdXT48L1ZBU1RBZFRhZ1VSST4gPEVycm9yPjwhW0NEQVRBW2h0dHBzOi8vYWt0cmFjay5wdWJtYXRpYy5jb20vdHJhY2s/b3BlcklkPTcmcD0xNTgwMTEmcz01NTEzMjQmYT0xOTU0NTAyJndhPTE2NSZ0cz0xNTYwMzM1Njk2JmNySWQ9MCZpbXBpZD03NDk3M0RBNy1BNkI4LTQ0OEYtOUEzRi0xNEE0NjVCNkNFRDQmZWNwbT0xLjIwMDAwMCZlcj1bRVJST1JDT0RFXV1dPjwvRXJyb3I+IDxFcnJvcj48IVtDREFUQVtodHRwczovL2ltYWdlOC5wdWJtYXRpYy5jb20vQWRTZXJ2ZXIvSW1nU3luYz8mZnA9MSZtcGM9MTAmcD0xNTgwMTEmZ2Rwcj0wJmdkcHJfY29uc2VudD0xJnBtYz0tMSZwdT1odHRwcyUzQSUyRiUyRmltYWdlNC5wdWJtYXRpYy5jb20lMkZBZFNlcnZlciUyRlNQdWclM0ZwbWMlM0QtMSUyNnBhcnRuZXJJRCUzRDE1ODAxMSUyNnBhcnRuZXJVSUQlM0QlMjhudWxsJTI5XV0+PC9FcnJvcj4gPEltcHJlc3Npb24+PCFbQ0RBVEFbaHR0cHM6Ly9ha3RyYWNrLnB1Ym1hdGljLmNvbS9BZFNlcnZlci9BZERpc3BsYXlUcmFja2VyU2VydmxldD9vcGVySWQ9MSZwdWJJZD0xNTgwMTEmc2l0ZUlkPTU1MTMyNCZhZElkPTE5NTQ1MDImYWRUeXBlPTEzJmFkU2VydmVySWQ9MTY1JmtlZmFjdD17UFNQTX0ma2F4ZWZhY3Q9e1BTUE19JmthZE5ldEZyZXF1ZWN5PTAma2Fkd2lkdGg9MCZrYWRoZWlnaHQ9MCZrYWRzaXplaWQ9MCZrbHRzdGFtcD0xNTYwMzM1Njk2JmluZGlyZWN0QWRJZD0xNzIwNzExJmFkU2VydmVyT3B0aW1pemVySWQ9MSZyYW5yZXE9Tk9SQU5ET01OVU1CRVJTUEVDSUZJRUQma3BibXRwZmFjdD17UFNQTX0mdGxkSWQ9MCZwYXNzYmFjaz0yNSZla2VmYWN0PXtQU1BNfSZla2F4ZWZhY3Q9e1BTUE19JmVrcGJtdHBmYWN0PXtQU1BNfSZzdnI9QURTNTUwMDNVJmNySUQ9MCZjYW1wYWlnbklkPTAmaXNSVEI9MCZrdWlwPTExNS4xMTQuMTM0LjE3NCZpbXBySWQ9NzQ5NzNEQTctQTZCOC00NDhGLTlBM0YtMTRBNDY1QjZDRUQ0Jm9pZD03NDk3M0RBNy1BNkI4LTQ0OEYtOUEzRi0xNEE0NjVCNkNFRDQmY250cnlJZD0xMDcmc2VjPTFdXT48L0ltcHJlc3Npb24+IDxJbXByZXNzaW9uPjwhW0NEQVRBW2h0dHBzOi8vaW1hZ2U4LnB1Ym1hdGljLmNvbS9BZFNlcnZlci9JbWdTeW5jPyZmcD0xJm1wYz0xMCZwPTE1ODAxMSZnZHByPTAmZ2Rwcl9jb25zZW50PTEmcG1jPS0xJnB1PWh0dHBzJTNBJTJGJTJGaW1hZ2U0LnB1Ym1hdGljLmNvbSUyRkFkU2VydmVyJTJGU1B1ZyUzRnBtYyUzRC0xJTI2cGFydG5lcklEJTNEMTU4MDExJTI2cGFydG5lclVJRCUzRCUyOG51bGwlMjldXT48L0ltcHJlc3Npb24+IDxDcmVhdGl2ZXM+IDxDcmVhdGl2ZT4gPExpbmVhcj4gPFRyYWNraW5nRXZlbnRzPiA8VHJhY2tpbmcgZXZlbnQ9ImNyZWF0aXZlVmlldyI+PCFbQ0RBVEFbaHR0cHM6Ly9ha3RyYWNrLnB1Ym1hdGljLmNvbS90cmFjaz9vcGVySWQ9NyZwPTE1ODAxMSZzPTU1MTMyNCZhPTE5NTQ1MDImd2E9MTY1JnRzPTE1NjAzMzU2OTYmY3JJZD0wJmltcGlkPTc0OTczREE3LUE2QjgtNDQ4Ri05QTNGLTE0QTQ2NUI2Q0VENCZlY3BtPTEuMjAwMDAwJmU9MV1dPjwvVHJhY2tpbmc+IDxUcmFja2luZyBldmVudD0ic3RhcnQiPjwhW0NEQVRBW2h0dHBzOi8vYWt0cmFjay5wdWJtYXRpYy5jb20vdHJhY2s/b3BlcklkPTcmcD0xNTgwMTEmcz01NTEzMjQmYT0xOTU0NTAyJndhPTE2NSZ0cz0xNTYwMzM1Njk2JmNySWQ9MCZpbXBpZD03NDk3M0RBNy1BNkI4LTQ0OEYtOUEzRi0xNEE0NjVCNkNFRDQmZWNwbT0xLjIwMDAwMCZlPTJdXT48L1RyYWNraW5nPiA8VHJhY2tpbmcgZXZlbnQ9Im1pZHBvaW50Ij48IVtDREFUQVtodHRwczovL2FrdHJhY2sucHVibWF0aWMuY29tL3RyYWNrP29wZXJJZD03JnA9MTU4MDExJnM9NTUxMzI0JmE9MTk1NDUwMiZ3YT0xNjUmdHM9MTU2MDMzNTY5NiZjcklkPTAmaW1waWQ9NzQ5NzNEQTctQTZCOC00NDhGLTlBM0YtMTRBNDY1QjZDRUQ0JmVjcG09MS4yMDAwMDAmZT0zXV0+PC9UcmFja2luZz4gPFRyYWNraW5nIGV2ZW50PSJmaXJzdFF1YXJ0aWxlIj48IVtDREFUQVtodHRwczovL2FrdHJhY2sucHVibWF0aWMuY29tL3RyYWNrP29wZXJJZD03JnA9MTU4MDExJnM9NTUxMzI0JmE9MTk1NDUwMiZ3YT0xNjUmdHM9MTU2MDMzNTY5NiZjcklkPTAmaW1waWQ9NzQ5NzNEQTctQTZCOC00NDhGLTlBM0YtMTRBNDY1QjZDRUQ0JmVjcG09MS4yMDAwMDAmZT00XV0+PC9UcmFja2luZz4gPFRyYWNraW5nIGV2ZW50PSJ0aGlyZFF1YXJ0aWxlIj48IVtDREFUQVtodHRwczovL2FrdHJhY2sucHVibWF0aWMuY29tL3RyYWNrP29wZXJJZD03JnA9MTU4MDExJnM9NTUxMzI0JmE9MTk1NDUwMiZ3YT0xNjUmdHM9MTU2MDMzNTY5NiZjcklkPTAmaW1waWQ9NzQ5NzNEQTctQTZCOC00NDhGLTlBM0YtMTRBNDY1QjZDRUQ0JmVjcG09MS4yMDAwMDAmZT01XV0+PC9UcmFja2luZz4gPFRyYWNraW5nIGV2ZW50PSJjb21wbGV0ZSI+PCFbQ0RBVEFbaHR0cHM6Ly9ha3RyYWNrLnB1Ym1hdGljLmNvbS90cmFjaz9vcGVySWQ9NyZwPTE1ODAxMSZzPTU1MTMyNCZhPTE5NTQ1MDImd2E9MTY1JnRzPTE1NjAzMzU2OTYmY3JJZD0wJmltcGlkPTc0OTczREE3LUE2QjgtNDQ4Ri05QTNGLTE0QTQ2NUI2Q0VENCZlY3BtPTEuMjAwMDAwJmU9Nl1dPjwvVHJhY2tpbmc+IDwvVHJhY2tpbmdFdmVudHM+IDxWaWRlb0NsaWNrcz4gPENsaWNrVHJhY2tpbmc+PCFbQ0RBVEFbaHR0cHM6Ly9ha3RyYWNrLnB1Ym1hdGljLmNvbS90cmFjaz9vcGVySWQ9NyZwPTE1ODAxMSZzPTU1MTMyNCZhPTE5NTQ1MDImd2E9MTY1JnRzPTE1NjAzMzU2OTYmY3JJZD0wJmltcGlkPTc0OTczREE3LUE2QjgtNDQ4Ri05QTNGLTE0QTQ2NUI2Q0VENCZlY3BtPTEuMjAwMDAwJmU9OTldXT48L0NsaWNrVHJhY2tpbmc+IDwvVmlkZW9DbGlja3M+IDwvTGluZWFyPiA8L0NyZWF0aXZlPiA8L0NyZWF0aXZlcz4gPEV4dGVuc2lvbnM+IDxFeHRlbnNpb24+IDxNZXRhPjwhW0NEQVRBW25hbWU9cG0tcGl4ZWw7dmVyPTEuMF1dPjwvTWV0YT4gPFBpeGVsIHB1cnBvc2U9IjEiIGxvYz0iMCI+IDxDb2RlIHR5cGU9IjAiPjwhW0NEQVRBWzxzY3JpcHQ+KGZ1bmN0aW9uICgpe3RyeXt2YXIgd2luZG93ID0gd2luZG93ID8gd2luZG93LnBhcmVudCA6IHRoaXMucGFyZW50OyAvKkNvcHlyaWdodCAoYykgMjAxMS0yMDE2IE1vYXQgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLiovIGZ1bmN0aW9uIGluaXRNb2F0VHJhY2tpbmcoYixjLGcscCl7dmFyIGw9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0IiksZj17ZXZlbnRzOltdLGFkZEV2ZW50OmZ1bmN0aW9uKGEpe2Quc2VuZEV2ZW50PyhmLmV2ZW50cyYmKGQuc2VuZEV2ZW50KGYuZXZlbnRzKSxmLmV2ZW50cz0hMSksZC5zZW5kRXZlbnQoYSkpOmYuZXZlbnRzLnB1c2goYSl9fSxhPWZ1bmN0aW9uKGEpe3JldHVybiBmdW5jdGlvbigpe3ZhciBkPS0xLGg7YiYmYi5nZXRBZFZvbHVtZSYmKGg9Yi5nZXRBZFZvbHVtZSgpKTsibnVtYmVyIj09dHlwZW9mIGgmJiFpc05hTihoKSYmMDw9aCYmKGQ9aCk7Zi5hZGRFdmVudCh7dHlwZTphLGFkVm9sdW1lOmR9KTtpZigtMSE9PXEuaW5kZXhPZihhKSYmYiYmYi51bnN1YnNjcmliZSYmIW4pe249ITA7Zm9yKHZhciBjIGluIGUpaWYoZS5oYXNPd25Qcm9wZXJ0eSYmZS5oYXNPd25Qcm9wZXJ0eShjKSl0cnl7Yi51bnN1YnNjcmliZShlW2NdLGMpfWNhdGNoKGcpe319fX0sIGQ9e2FkRGF0YTp7aWRzOmcsdnBhaWQ6YixidWlsZDoiY2MwN2E4MC1jbGVhbiJ9LGRpc3BhdGNoRXZlbnQ6Zi5hZGRFdmVudH07Zz0iX21vYXRBcGkiK01hdGguZmxvb3IoMUU4Kk1hdGgucmFuZG9tKCkpO3ZhciBlPXtBZFN0YXJ0ZWQ6YSgiQWRTdGFydGVkIiksQWRTdG9wcGVkOmEoIkFkU3RvcHBlZCIpLEFkU2tpcHBlZDphKCJBZFNraXBwZWQiKSxBZExvYWRlZDphKCJBZExvYWRlZCIpLEFkTGluZWFyQ2hhbmdlOmEoIkFkTGluZWFyQ2hhbmdlIiksQWRTaXplQ2hhbmdlOmEoIkFkU2l6ZUNoYW5nZSIpLEFkRXhwYW5kZWRDaGFuZ2U6YSgiQWRFeHBhbmRlZENoYW5nZSIpLEFkU2tpcHBhYmxlU3RhdGVDaGFuZ2U6YSgiQWRTa2lwcGFibGVTdGF0ZUNoYW5nZSIpLEFkRHVyYXRpb25DaGFuZ2U6YSgiQWREdXJhdGlvbkNoYW5nZSIpLEFkUmVtYWluaW5nVGltZUNoYW5nZTphKCJBZFJlbWFpbmluZ1RpbWVDaGFuZ2UiKSxBZFZvbHVtZUNoYW5nZTphKCJBZFZvbHVtZUNoYW5nZSIpLCBBZEltcHJlc3Npb246YSgiQWRJbXByZXNzaW9uIiksQWRDbGlja1RocnU6YSgiQWRDbGlja1RocnUiKSxBZEludGVyYWN0aW9uOmEoIkFkSW50ZXJhY3Rpb24iKSxBZFZpZGVvU3RhcnQ6YSgiQWRWaWRlb1N0YXJ0IiksQWRWaWRlb0ZpcnN0UXVhcnRpbGU6YSgiQWRWaWRlb0ZpcnN0UXVhcnRpbGUiKSxBZFZpZGVvTWlkcG9pbnQ6YSgiQWRWaWRlb01pZHBvaW50IiksQWRWaWRlb1RoaXJkUXVhcnRpbGU6YSgiQWRWaWRlb1RoaXJkUXVhcnRpbGUiKSxBZFZpZGVvQ29tcGxldGU6YSgiQWRWaWRlb0NvbXBsZXRlIiksQWRVc2VyQWNjZXB0SW52aXRhdGlvbjphKCJBZFVzZXJBY2NlcHRJbnZpdGF0aW9uIiksQWRVc2VyTWluaW1pemU6YSgiQWRVc2VyTWluaW1pemUiKSxBZFVzZXJDbG9zZTphKCJBZFVzZXJDbG9zZSIpLEFkUGF1c2VkOmEoIkFkUGF1c2VkIiksQWRQbGF5aW5nOmEoIkFkUGxheWluZyIpLEFkRXJyb3I6YSgiQWRFcnJvciIpfSxuPSExLHE9WyJBZFN0b3BwZWQiLCJBZFNraXBwZWQiLCAiQWRWaWRlb0NvbXBsZXRlIl07KGZ1bmN0aW9uKCl7aWYoYiYmYi5zdWJzY3JpYmUpZm9yKHZhciBhIGluIGUpZS5oYXNPd25Qcm9wZXJ0eSYmZS5oYXNPd25Qcm9wZXJ0eShhKSYmYi5zdWJzY3JpYmUoZVthXSxhKX0pKCk7dmFyIGssbTt0cnl7az1jLm93bmVyRG9jdW1lbnQsbT1rLmRlZmF1bHRWaWV3fHxrLnBhcmVudFdpbmRvd31jYXRjaChyKXtrPWRvY3VtZW50LG09d2luZG93fW1bZ109ZDtsLnR5cGU9InRleHQvamF2YXNjcmlwdCI7YyYmYy5pbnNlcnRCZWZvcmUobCxjLmNoaWxkTm9kZXNbMF18fG51bGwpO2wuc3JjPSJodHRwczovL3oubW9hdGFkcy5jb20vIitwKyIvbW9hdHZpZGVvLmpzIyIrZztyZXR1cm4gZH07IGxldCBwbVZQQUlEUmVmID0gd2luZG93LmdldFZQQUlEQWQoKTsgbGV0IHBsYXllclJlZiA9IHdpbmRvdy5BZFBhcmFtQ29uZmlnUmVhZGVyLnZwYWlkICYmIHdpbmRvdy5BZFBhcmFtQ29uZmlnUmVhZGVyLnZwYWlkLl9zbG90OyBsZXQgaWRzID0geyJ6TW9hdFRhZ1R5cGUiOiJ2aWRlbyIsICJ6TW9hdEltcCI6Ijc0OTczREE3LUE2QjgtNDQ4Ri05QTNGLTE0QTQ2NUI2Q0VENCIsICJsZXZlbDEiOiIxNTgwMTEiLCAibGV2ZWwyIjoiNTUxMzI0IiwgImxldmVsMyI6IjE5NTQ1MDIiLCAiek1vYXRQUCI6IjEuMiIsICJzbGljZXIxIjoiIiwgImxldmVsNCI6IjEiLCAic2xpY2VyMiI6IiIsICJ6TW9hdENudHJ5IjoiMTA3IiwgInpNb2F0QWR2IjoiMSIsICJ6TW9hdENhbXAiOiIwIiwgInNsaWNlcjMiOiIwIiwgInpNb2F0RFNQIjoiMCIsICJ6TW9hdEJpZCI6IiIsICJ6TW9hdFVDUiI6IjAifTsgbGV0IHBhcnRuZXJDb2RlPSJwdWJtYXRpY3ZwYWlkanNpbnQ0Njk4MTU3MTAzMTIiOyB2YXIgTW9hdEFwaVJlZmVyZW5jZSA9IGluaXRNb2F0VHJhY2tpbmcocG1WUEFJRFJlZiwgcGxheWVyUmVmLCBpZHMsIHBhcnRuZXJDb2RlKTsgY29uc29sZS5sb2coIlBpeGVsOiAiICsgTW9hdEFwaVJlZmVyZW5jZSk7fSBjYXRjaChleCkge2NvbnNvbGUuZXJyb3IoIkVycm9yIGluIHBpeGVsIGV4ZWN1dGlvbjogIiArIGV4KX0gfSkoKTs8L3NjcmlwdD5dXT48L0NvZGU+IDwvUGl4ZWw+IDwvRXh0ZW5zaW9uPiA8RXh0ZW5zaW9uPiA8TWV0YT48IVtDREFUQVtuYW1lPXBtLWZvcmNlcGl4ZWw7dmVyPTEuMF1dPjwvTWV0YT4gPFBpeGVsIGxvYz0iMCI+IDxDb2RlIHR5cGU9IjEiPjwhW0NEQVRBW2h0dHBzOi8vYWRzLnB1Ym1hdGljLmNvbS9BZFNlcnZlci9qcy9zaG93YWQuanMjUElYJnB0YXNrPURTUCZTUHVnPTEmZnA9MSZtcGM9MTAmdT00NzI1NkNBQi0yNURGLTRDMUYtOUI0NS1BMkUxNkVCQzZENUEmcD0xNTgwMTEmcz01NTEzMjQmZD00JmNwPTAmc2M9MSZycz0wJm9zPTAmZ2Rwcj0wJmdkcHJfY29uc2VudD0xXV0+PC9Db2RlPiA8L1BpeGVsPiA8L0V4dGVuc2lvbj4gPC9FeHRlbnNpb25zPiA8L1dyYXBwZXI+IDwvQWQ+IDwvVkFTVD4=';
        let base64String = 'data:text/xml;charset=utf-8;base64,' + base64Encoding;
        let obj = fluidPlayerConfig(bid, elementId, genericConfiguration);
        expect(obj.vastOptions.adList[0].vastTag).toEqual(base64String);
    });

    test('vastLoadedCallback - it should call logger', () => {
        let value = obj.vastOptions.vastAdvanced.vastLoadedCallback();
        expect(value).toBeUndefined();
        expect(logger.info).toHaveBeenNthCalledWith(1, 'vastLoadedCallback - VAST loaded');
    });

    test('noVastVideoCallback - it should hide the element', () => {
        let value = obj.vastOptions.vastAdvanced.noVastVideoCallback();
        expect(value).toBeUndefined();
        expect(document.getElementById(elementId)!.style.display).toBe('none');
        expect(logger.info).toHaveBeenNthCalledWith(1, 'noVastVideoCallback - empty VAST');
        expect(logger.log).toHaveBeenNthCalledWith(
            1,
            'noVastVideoCallback - remove element from DOM.'
        );
    });

    test('vastVideoSkippedCallback - it should hide the element', () => {
        let value = obj.vastOptions.vastAdvanced.vastVideoSkippedCallback();
        expect(value).toBeUndefined();
        expect(document.getElementById(elementId)!.style.display).toBe('none');
        expect(logger.info).toHaveBeenNthCalledWith(1, 'vastVideoSkippedCallback - Ad is skipped');
        expect(logger.log).toHaveBeenNthCalledWith(
            1,
            'vastVideoSkippedCallback - remove element from DOM.'
        );
    });

    test('vastVideoEndedCallback - it should hide the element', () => {
        let value = obj.vastOptions.vastAdvanced.vastVideoEndedCallback();
        expect(value).toBeUndefined();
        expect(document.getElementById(elementId)!.style.display).toBe('none');
        expect(logger.info).toHaveBeenNthCalledWith(1, 'vastVideoEndedCallback - Ad ended');
        expect(logger.log).toHaveBeenNthCalledWith(
            1,
            'vastVideoEndedCallback - remove element from DOM.'
        );
    });

    test('playerInitCallback - it should call logger', () => {
        let value = obj.layoutControls.playerInitCallback();
        expect(value).toBeUndefined();
        expect(logger.log).toHaveBeenNthCalledWith(1, 'Fluid player loaded callback!');
    });
});
